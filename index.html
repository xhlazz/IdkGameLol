<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Te Amo Sorpresa</title>
  <link rel="stylesheet" href="te-amo-stars.css" />
</head>
<body>
  <canvas id="stars-bg"></canvas>
  <button id="center-btn">Click Para Una Sorpresa</button>
  <canvas id="surprise-canvas"></canvas>
  <script>
    // --- STARS Background ---
    const starsCanvas = document.getElementById('stars-bg');
    const starsCtx = starsCanvas.getContext('2d');
    let stars = [];
    function resizeStarsCanvas() {
      starsCanvas.width = window.innerWidth;
      starsCanvas.height = window.innerHeight;
    }
    resizeStarsCanvas();
    window.addEventListener('resize', resizeStarsCanvas);
    for (let i = 0; i < 140; i++) {
      stars.push({
        x: Math.random() * window.innerWidth,
        y: Math.random() * window.innerHeight,
        r: Math.random() * 1.5 + 0.5,
        a: Math.random() * Math.PI * 2,
        tw: Math.random() * 0.5 + 0.5,
      });
    }
    function drawStars() {
      starsCtx.clearRect(0, 0, starsCanvas.width, starsCanvas.height);
      for (const star of stars) {
        star.a += 0.02 + star.tw * 0.01;
        const alpha = 0.6 + Math.sin(star.a) * 0.4;
        starsCtx.beginPath();
        starsCtx.arc(star.x, star.y, star.r, 0, Math.PI * 2);
        starsCtx.fillStyle = `rgba(255,255,255,${alpha})`;
        starsCtx.fill();
      }
      requestAnimationFrame(drawStars);
    }
    drawStars();

    // --- SURPRISE Animation ---
    const btn = document.getElementById('center-btn');
    const surpriseCanvas = document.getElementById('surprise-canvas');
    const ctx = surpriseCanvas.getContext('2d');

    function resizeSurpriseCanvas() {
      surpriseCanvas.width = window.innerWidth;
      surpriseCanvas.height = window.innerHeight;
    }
    resizeSurpriseCanvas();
    window.addEventListener('resize', resizeSurpriseCanvas);

    // Turret pixel art (simple, stylized)
    function drawTurret(ctx, x, y, side, frame) {
      ctx.save();
      ctx.translate(x, y);
      ctx.scale(2.2, 2.2);
      if (side === 'left') ctx.scale(-1, 1);
      ctx.fillStyle = '#333';
      ctx.fillRect(-12, 8, 24, 14);
      ctx.fillStyle = '#666';
      ctx.fillRect(-7, 4, 14, 6);
      ctx.save();
      ctx.translate(0, 0);
      ctx.rotate(Math.sin(frame*0.04) * 0.07 * (side === 'left' ? 1 : -1));
      ctx.fillStyle = '#ddd';
      ctx.fillRect(-3, -14, 6, 18);
      ctx.restore();
      ctx.beginPath();
      ctx.arc(0, 15, 3, 0, Math.PI*2);
      ctx.fillStyle = frame % 40 < 20 ? '#f00' : '#ee0';
      ctx.fill();
      ctx.restore();
    }

    // Smooth heart (canvas vector, not pixel)
    function drawSmoothHeart(ctx, x, y, size, color, rot=0, alpha=1) {
      ctx.save();
      ctx.translate(x, y);
      ctx.rotate(rot);
      ctx.globalAlpha = alpha;
      ctx.beginPath();
      for (let t = 0; t < Math.PI * 2; t += 0.06) {
        let px = size * 16 * Math.pow(Math.sin(t), 3) / 17;
        let py = -size * (13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t)) / 17;
        if (t === 0) ctx.moveTo(px, py);
        else ctx.lineTo(px, py);
      }
      ctx.closePath();
      ctx.fillStyle = color;
      ctx.shadowColor = color;
      ctx.shadowBlur = size * 0.6;
      ctx.fill();
      ctx.restore();
    }

    // Heart shooting & Te Amo layout
    let hearts = [];
    let animFrame = 0;
    let turretsVisible = false;
    let bigHeartAngle = 0;

    // More detailed "Te Amo" heart positions for top of screen
    // Designed to look more like text, not pixel grid
    // Each letter is made with a set of (x, y) relative positions
    function getTeAmoLayout(screenWidth, screenHeight) {
      const topY = Math.max(screenHeight * 0.16, 70);
      const startX = screenWidth/2 - 260;
      const heartSize = 19;
      let coords = [];
      // T
      for(let i=0;i<7;i++) coords.push([startX+heartSize*i,topY]);
      for(let i=0;i<3;i++) coords.push([startX+heartSize*3,topY+heartSize*(i+1)]);
      // E
      let ex = startX+heartSize*8;
      for(let i=0;i<5;i++) coords.push([ex,topY+heartSize*i]);
      for(let i=1;i<=3;i++) coords.push([ex+heartSize*i,topY]);
      coords.push([ex+heartSize,topY+heartSize*2]);
      for(let i=1;i<=3;i++) coords.push([ex+heartSize*i,topY+heartSize*4]);
      // A
      let ax = startX+heartSize*15;
      for(let i=0;i<5;i++) coords.push([ax+heartSize*i,topY+heartSize*4]);
      for(let i=0;i<5;i++) coords.push([ax,topY+heartSize*i]);
      for(let i=0;i<3;i++) coords.push([ax+heartSize*2,topY+heartSize*(i+2)]);
      // M
      let mx = startX+heartSize*22;
      for(let i=0;i<5;i++) coords.push([mx,topY+heartSize*i]);
      for(let i=1;i<=2;i++) coords.push([mx+heartSize*i,topY+heartSize*i]);
      for(let i=0;i<5;i++) coords.push([mx+heartSize*4,topY+heartSize*i]);
      for(let i=1;i<=3;i++) coords.push([mx+heartSize*i,topY]);
      // O
      let ox = startX+heartSize*30;
      for(let i=0;i<5;i++) coords.push([ox,topY+heartSize*i]);
      for(let i=0;i<5;i++) coords.push([ox+heartSize*4,topY+heartSize*i]);
      for(let i=1;i<=3;i++) coords.push([ox+heartSize*i,topY]);
      for(let i=1;i<=3;i++) coords.push([ox+heartSize*i,topY+heartSize*4]);
      return coords;
    }

    function startSurprise() {
      btn.style.opacity = 0;
      setTimeout(() => { btn.style.display = 'none'; }, 600);
      surpriseCanvas.style.display = 'block';
      turretsVisible = true;
      hearts = [];
      animFrame = 0;
    }
    btn.addEventListener('click', startSurprise);

    // Animate hearts flying from turrets to positions
    function animateSurprise() {
      ctx.clearRect(0, 0, surpriseCanvas.width, surpriseCanvas.height);

      const w = surpriseCanvas.width, h = surpriseCanvas.height;
      const turretY = h-40, turretX1 = 80, turretX2 = w-80;

      // Get destination positions for 'Te Amo' hearts at top
      const teAmoCoords = getTeAmoLayout(w, h);

      // Draw turrets (bottom left/right)
      if (turretsVisible) {
        drawTurret(ctx, turretX1, turretY, 'left', animFrame);
        drawTurret(ctx, turretX2, turretY, 'right', animFrame);

        // Launch hearts to "TE AMO"
        if (hearts.length < teAmoCoords.length) {
          // Launch one heart per few frames from random turret
          if (animFrame % 7 === 0) {
            const idx = hearts.length;
            const [tx, ty] = teAmoCoords[idx];
            const fromTurret = idx%2===0 ?
              [turretX1+12, turretY-46] : [turretX2-12, turretY-46];
            hearts.push({
              x: fromTurret[0], y: fromTurret[1], tx, ty,
              progress: 0,
              color: '#ff1361',
              rot: 0,
              alpha: 1,
            });
          }
        }

        // Animate hearts flying to their spots
        for (const heart of hearts) {
          if (heart.progress < 1) {
            heart.x += (heart.tx - heart.x) * 0.07;
            heart.y += (heart.ty - heart.y) * 0.07;
            heart.progress += 0.08;
            heart.rot += 0.17;
            heart.alpha = 0.7 + 0.3 * Math.sin(animFrame*0.2 + heart.x/60);
          } else {
            heart.x = heart.tx; heart.y = heart.ty;
            heart.rot = 0;
            heart.alpha = 1;
          }
          drawSmoothHeart(ctx, heart.x, heart.y, 17, heart.color, heart.rot, heart.alpha);
        }
      }

      // Big spinning heart below the text
      if (hearts.length === teAmoCoords.length) {
        bigHeartAngle += 0.02;
        drawSmoothHeart(ctx, w/2, h*0.52, 45, '#ff1361', bigHeartAngle, 1);
        // Glow
        ctx.save();
        ctx.globalAlpha = 0.13;
        ctx.beginPath();
        ctx.arc(w/2, h*0.52, 80, 0, Math.PI*2);
        ctx.fillStyle = "#ff1361";
        ctx.fill();
        ctx.restore();
      }

      animFrame++;
      requestAnimationFrame(animateSurprise);
    }
    animateSurprise();

  </script>
</body>
</html>
