<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Te Amo Sorpresa</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      width: 100vw;
      height: 100vh;
      background: radial-gradient(ellipse at bottom, #4a1b5f 0%, #0e1c39 100%);
      font-family: 'Arial Rounded MT Bold', Arial, sans-serif;
    }
    #stars-bg, #surprise-canvas {
      position: absolute;
      left: 0; top: 0;
      width: 100vw; height: 100vh;
      z-index: 0;
      pointer-events: none;
      display: block;
    }
    #center-btn {
      position: absolute;
      left: 50%; top: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      color: #d9296a;
      border: none;
      padding: 1em 2.2em;
      font-size: 2em;
      font-weight: bold;
      letter-spacing: 0.06em;
      border-radius: 1em;
      box-shadow: 0 0 38px #fff7, 0 0 18px #ff6ec7;
      z-index: 2;
      cursor: pointer;
      transition: opacity 0.5s;
    }
    #center-btn:active {
      background: #ffeaff;
      box-shadow: 0 0 20px #ff6ec7;
    }
    #surprise-canvas { z-index: 1; display: none; }
  </style>
</head>
<body>
  <canvas id="stars-bg"></canvas>
  <button id="center-btn">Click Para Una Sorpresa</button>
  <canvas id="surprise-canvas"></canvas>
  <script>
    // --- STAR BACKGROUND with shooting star ---
    const starsCanvas = document.getElementById('stars-bg');
    const starsCtx = starsCanvas.getContext('2d');
    let stars = [], shootingStar = null;
    function resizeStarsCanvas() {
      starsCanvas.width = window.innerWidth;
      starsCanvas.height = window.innerHeight;
    }
    resizeStarsCanvas();
    window.addEventListener('resize', resizeStarsCanvas);

    function createStars() {
      stars = [];
      let layers = [0.3, 0.7, 1];
      let colors = ['#fff', '#aef', '#fee'];
      for (let l = 0; l < layers.length; l++) {
        for (let i = 0; i < 50 + l * 20; i++) {
          stars.push({
            x: Math.random() * window.innerWidth,
            y: Math.random() * window.innerHeight,
            r: Math.random() * 1.4 + 0.8 + l * 0.4,
            a: Math.random() * Math.PI * 2,
            tw: Math.random() * 0.9 + 0.5,
            layer: layers[l],
            color: colors[l]
          });
        }
      }
      shootingStar = {
        progress: 0,
        x0: Math.random() * starsCanvas.width * 0.5 + starsCanvas.width * 0.1,
        y0: Math.random() * starsCanvas.height * 0.2 + starsCanvas.height * 0.1,
        dx: Math.random() * 90 + 80,
        dy: Math.random() * 35 + 15
      };
    }
    createStars();
    window.addEventListener('resize', createStars);

    function drawStars() {
      starsCtx.clearRect(0, 0, starsCanvas.width, starsCanvas.height);
      for (const star of stars) {
        star.a += 0.016 + star.tw * 0.011;
        let alpha = 0.55 + Math.sin(star.a) * 0.35;
        let px = star.x + Math.sin(star.a * 0.13) * 7 * star.layer;
        let py = star.y + Math.cos(star.a * 0.17) * 4.5 * star.layer;
        starsCtx.beginPath();
        starsCtx.arc(px, py, star.r, 0, Math.PI * 2);
        starsCtx.fillStyle = `rgba(${star.color === '#fff' ? '255,255,255' : star.color === '#aef' ? '170,238,255' : '255,238,238'},${alpha})`;
        starsCtx.shadowColor = star.color;
        starsCtx.shadowBlur = 12 * star.layer;
        starsCtx.fill();
        starsCtx.shadowBlur = 0;
      }
      // Shooting star
      if (shootingStar) {
        let p = shootingStar.progress;
        if (p < 1) {
          let x = shootingStar.x0 + shootingStar.dx * p;
          let y = shootingStar.y0 + shootingStar.dy * p;
          starsCtx.save();
          starsCtx.globalAlpha = 0.7;
          starsCtx.strokeStyle = "#fff";
          starsCtx.lineWidth = 2.4;
          starsCtx.beginPath();
          starsCtx.moveTo(x-shootingStar.dx*0.22, y-shootingStar.dy*0.22);
          starsCtx.lineTo(x, y);
          starsCtx.stroke();
          starsCtx.restore();
          shootingStar.progress += 0.009;
          if (shootingStar.progress > 1.05) shootingStar = null;
        } else if (Math.random() < 0.002) {
          createStars();
        }
      }
      requestAnimationFrame(drawStars);
    }
    drawStars();

    // --- MODERN HEART ANIMATION ---
    const btn = document.getElementById('center-btn');
    const canvas = document.getElementById('surprise-canvas');
    const ctx = canvas.getContext('2d');
    function resizeSurpriseCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resizeSurpriseCanvas();
    window.addEventListener('resize', resizeSurpriseCanvas);

    // Draw a cute turret: arms animate for shooting, bounce for dancing
    function drawCharacter(ctx, x, y, facing, shootPhase, dancePhase, frame) {
      ctx.save();
      ctx.translate(x, y);

      // Modern bounce for dance
      if (dancePhase > 0) {
        ctx.translate(0, Math.sin(frame * 0.20 + (facing === 'left' ? 1 : 0)) * 10 * dancePhase);
        ctx.rotate(Math.sin(frame*0.14 + (facing==='left'?1.7:0))*0.19*dancePhase);
      }

      ctx.scale(facing === 'left' ? -1 : 1, 1);

      // Glow
      if (shootPhase > 0.1) {
        ctx.save();
        ctx.globalAlpha = 0.22 + shootPhase*0.18;
        ctx.shadowColor = "#ff1361";
        ctx.shadowBlur = 19 * shootPhase;
        ctx.beginPath();
        ctx.arc(0, 0, 27, 0, Math.PI*2);
        ctx.fillStyle = "#ff1361";
        ctx.fill();
        ctx.restore();
      }

      // Body
      ctx.beginPath();
      ctx.arc(0, 0, 20, 0, Math.PI * 2);
      ctx.fillStyle = "#fff";
      ctx.shadowColor = "#666";
      ctx.shadowBlur = 8;
      ctx.fill();
      ctx.shadowBlur = 0;

      // Eyes
      ctx.beginPath(); ctx.arc(-7, -3, 3.2, 0, Math.PI * 2);
      ctx.arc(7, -3, 3.2, 0, Math.PI * 2);
      ctx.fillStyle = "#222";
      ctx.fill();

      // Smile (big smile if dancing)
      ctx.beginPath();
      let smileY = dancePhase ? 13 : 8;
      let smileR = dancePhase ? 9.5 : 7.5;
      ctx.arc(0, smileY, smileR, Math.PI*0.14, Math.PI*0.86);
      ctx.strokeStyle = "#222";
      ctx.lineWidth = 2.3;
      ctx.stroke();

      // Arms: recoil and glow when shooting
      ctx.save();
      let armsUp = shootPhase ? Math.sin(frame*0.39)*0.38+0.77*shootPhase : (dancePhase?0.4:0.08);
      ctx.rotate(-armsUp);
      ctx.beginPath();
      ctx.arc(-15, 10, 7, Math.PI*0.4, Math.PI*1.6);
      ctx.lineWidth = 7;
      ctx.strokeStyle = "#fff";
      ctx.stroke();
      ctx.lineWidth = 2.2;
      ctx.strokeStyle = "#222";
      ctx.stroke();
      ctx.restore();

      ctx.save();
      ctx.rotate(armsUp);
      ctx.beginPath();
      ctx.arc(15, 10, 7, Math.PI*1.6, Math.PI*0.4, true);
      ctx.lineWidth = 7;
      ctx.strokeStyle = "#fff";
      ctx.stroke();
      ctx.lineWidth = 2.2;
      ctx.strokeStyle = "#222";
      ctx.stroke();
      ctx.restore();

      // Saucer
      ctx.save();
      ctx.translate(0, 24);
      ctx.beginPath();
      ctx.ellipse(0, 0, 22, 8, 0, 0, Math.PI * 2);
      ctx.fillStyle = "#eee";
      ctx.fill();
      ctx.beginPath();
      ctx.ellipse(0, 0, 22, 8, 0, 0, Math.PI * 2);
      ctx.strokeStyle = "#999";
      ctx.lineWidth = 2.8;
      ctx.stroke();
      ctx.restore();

      ctx.restore();
    }

    // Heart outline curve
    function getHeartOutline(w, h, heartsCount) {
      let cx = w / 2, cy = h * 0.45, r = Math.min(w,h)/3.1;
      let coords = [];
      for (let i = 0; i < heartsCount; i++) {
        let t = i / (heartsCount - 1);
        let angle = Math.PI * (1.13 * t + 0.18);
        let px = cx + Math.sin(angle) * r * (1 - 0.24 * Math.abs(t - 0.5));
        let py = cy - Math.cos(angle) * r - 42 * Math.abs(t - 0.5);
        coords.push({x: px, y: py, angle});
      }
      return coords;
    }

    // Fly-in hearts
    let flyingHearts = [], animationFrame = 0, shooting = true, dancing = false;
    let SHOOT_DURATION_FRAMES = 120; // 5s @ 24fps

    function startHeartAnimation() {
      flyingHearts = [];
      animationFrame = 0;
      shooting = true;
      dancing = false;
      const w = canvas.width, h = canvas.height;
      const heartOutline = getHeartOutline(w, h, 84);

      // Calculate stagger for smooth ~5s animation
      let totalFrames = SHOOT_DURATION_FRAMES;
      let spread = Math.max(heartOutline.length-1,1);
      for (let i = 0; i < heartOutline.length; i++) {
        let t = i / spread;
        let fromX = t < 0.5 ? 60 : w-60;
        let fromY = h-65;
        let {x: toX, y: toY} = heartOutline[i];
        let cpX = (fromX + toX)/2 + (t<0.5?-68:68);
        let cpY = Math.min(fromY, toY) - 140;
        flyingHearts.push({
          fromX, fromY, cpX, cpY, toX, toY,
          progress: 0,
          arrived: false,
          scale: 0.7,
          alpha: 0.2,
          rot: Math.random()*2*Math.PI,
          startFrame: Math.round(i * totalFrames/spread*0.98)
        });
      }
    }

    // Draw emoji heart with modern effect
    function drawEmojiHeart(ctx, x, y, size, rot, alpha, glow=0) {
      ctx.save();
      ctx.globalAlpha = alpha;
      ctx.font = `bold ${size}px serif`;
      ctx.translate(x, y);
      ctx.rotate(rot);
      ctx.shadowColor = "#ff1361";
      ctx.shadowBlur = size*0.21+glow;
      ctx.fillText("❤️", 0, 0);
      ctx.restore();
    }

    // Main animation loop
    function drawScene() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Compute shooting/dancing phases
      let allArrived = flyingHearts.every(h=>h.arrived);
      let shootPhase = shooting && !allArrived ? 1 : 0;
      let dancePhase = dancing && allArrived ? 1 : 0;

      // Draw turrets
      drawCharacter(ctx, 60, canvas.height - 65, 'right', shootPhase, dancePhase, animationFrame);
      drawCharacter(ctx, canvas.width - 60, canvas.height - 65, 'left', shootPhase, dancePhase, animationFrame);

      // Animate hearts
      for (let i = 0; i < flyingHearts.length; i++) {
        let heart = flyingHearts[i];
        let localFrame = animationFrame - heart.startFrame;
        if (localFrame < 0) {
          // Not launched yet
          continue;
        } else if (!heart.arrived) {
          let t = Math.min(localFrame / (SHOOT_DURATION_FRAMES/1.25), 1);
          heart.progress = t;
          if (t >= 1) {
            heart.arrived = true;
            heart.scale = 1;
            heart.alpha = 1;
            heart.rot = 0;
          }
        }
        let t = heart.progress;
        let bx = (1-t)*(1-t)*heart.fromX + 2*(1-t)*t*heart.cpX + t*t*heart.toX;
        let by = (1-t)*(1-t)*heart.fromY + 2*(1-t)*t*heart.cpY + t*t*heart.toY;
        let scale = heart.arrived ? 1 : 0.7+0.35*t;
        let alpha = heart.arrived ? 1 : 0.25+0.75*t;
        let rot = heart.arrived ? 0 : heart.rot*(1-t) + Math.sin(animationFrame*.13+i)*0.15*(1-t);
        let glow = heart.arrived ? 12 : 0;
        drawEmojiHeart(ctx, bx, by, 34*scale, rot, alpha, glow);
      }

      // If all hearts arrived, start dance
      if (allArrived) {
        shooting = false;
        dancing = true;
        // Modern glowing text
        ctx.save();
        ctx.font = "bold 60px Arial Rounded MT Bold, Arial, sans-serif";
        ctx.fillStyle = "#fa4f86";
        ctx.textAlign = "center";
        ctx.shadowColor = "#ff1361";
        ctx.shadowBlur = 28;
        ctx.globalAlpha = 1;
        ctx.fillText("Te amo", canvas.width / 2, canvas.height * 0.18);
        ctx.restore();
      }

      animationFrame++;
      requestAnimationFrame(drawScene);
    }

    btn.addEventListener("click", () => {
      btn.style.opacity = 0;
      setTimeout(() => { btn.style.display = 'none'; }, 600);
      canvas.style.display = "block";
      startHeartAnimation();
      drawScene();
    });
  </script>
</body>
</html>
