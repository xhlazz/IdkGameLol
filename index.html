<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Te Amo Sorpresa</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: radial-gradient(ellipse at bottom, #491a5e 0%, #0d1c39 100%);
      font-family: 'Arial Rounded MT Bold', Arial, sans-serif;
    }
    #stars-bg {
      position: absolute;
      width: 100vw;
      height: 100vh;
      left: 0;
      top: 0;
      z-index: 0;
      pointer-events: none;
    }
    #center-btn {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      color: #d9296a;
      border: none;
      padding: 1em 2em;
      font-size: 2em;
      font-weight: bold;
      letter-spacing: 0.06em;
      border-radius: 1em;
      box-shadow: 0 0 30px #fff7, 0 0 8px #ff6ec7;
      z-index: 2;
      cursor: pointer;
      transition: opacity 0.5s;
    }
    #center-btn:active {
      background: #ffeaff;
      box-shadow: 0 0 20px #ff6ec7;
    }
    #surprise-canvas {
      position: absolute;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      z-index: 1;
      pointer-events: none;
      display: none;
    }
  </style>
</head>
<body>
  <canvas id="stars-bg"></canvas>
  <button id="center-btn">Click Para Una Sorpresa</button>
  <canvas id="surprise-canvas"></canvas>
  <script>
    // --- STAR BACKGROUND with shooting star ---
    const starsCanvas = document.getElementById('stars-bg');
    const starsCtx = starsCanvas.getContext('2d');
    let stars = [], shootingStar = null;
    function resizeStarsCanvas() {
      starsCanvas.width = window.innerWidth;
      starsCanvas.height = window.innerHeight;
    }
    resizeStarsCanvas();
    window.addEventListener('resize', resizeStarsCanvas);

    function createStars() {
      stars = [];
      let layers = [0.3, 0.6, 1];
      let colors = ['#fff', '#aef', '#fee'];
      for (let l = 0; l < layers.length; l++) {
        for (let i = 0; i < 36 + l * 6; i++) {
          stars.push({
            x: Math.random() * window.innerWidth,
            y: Math.random() * window.innerHeight,
            r: Math.random() * 1.2 + 0.7 + l * 0.4,
            a: Math.random() * Math.PI * 2,
            tw: Math.random() * 0.8 + 0.3,
            layer: layers[l],
            color: colors[l]
          });
        }
      }
      shootingStar = {
        progress: 0,
        x0: Math.random() * starsCanvas.width * 0.5 + starsCanvas.width * 0.1,
        y0: Math.random() * starsCanvas.height * 0.2 + starsCanvas.height * 0.1,
        dx: Math.random() * 80 + 70,
        dy: Math.random() * 30 + 10
      };
    }
    createStars();
    window.addEventListener('resize', createStars);

    function drawStars() {
      starsCtx.clearRect(0, 0, starsCanvas.width, starsCanvas.height);
      for (const star of stars) {
        star.a += 0.015 + star.tw * 0.009;
        let alpha = 0.6 + Math.sin(star.a) * 0.37;
        let px = star.x + Math.sin(star.a * 0.11) * 6 * star.layer;
        let py = star.y + Math.cos(star.a * 0.13) * 3.5 * star.layer;
        starsCtx.beginPath();
        starsCtx.arc(px, py, star.r, 0, Math.PI * 2);
        starsCtx.fillStyle = `rgba(${star.color === '#fff' ? '255,255,255' : star.color === '#aef' ? '170,238,255' : '255,238,238'},${alpha})`;
        starsCtx.shadowColor = star.color;
        starsCtx.shadowBlur = 10 * star.layer;
        starsCtx.fill();
        starsCtx.shadowBlur = 0;
      }
      // Shooting star
      if (shootingStar) {
        let p = shootingStar.progress;
        if (p < 1) {
          let x = shootingStar.x0 + shootingStar.dx * p;
          let y = shootingStar.y0 + shootingStar.dy * p;
          starsCtx.save();
          starsCtx.globalAlpha = 0.7;
          starsCtx.strokeStyle = "#fff";
          starsCtx.lineWidth = 2.4;
          starsCtx.beginPath();
          starsCtx.moveTo(x-shootingStar.dx*0.22, y-shootingStar.dy*0.22);
          starsCtx.lineTo(x, y);
          starsCtx.stroke();
          starsCtx.restore();
          shootingStar.progress += 0.008;
          if (shootingStar.progress > 1.05) shootingStar = null;
        } else if (Math.random() < 0.002) {
          createStars();
        }
      }
      requestAnimationFrame(drawStars);
    }
    drawStars();

    // --- SURPRISE SCENE ---
    const btn = document.getElementById('center-btn');
    const canvas = document.getElementById('surprise-canvas');
    const ctx = canvas.getContext('2d');
    function resizeSurpriseCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resizeSurpriseCanvas();
    window.addEventListener('resize', resizeSurpriseCanvas);

    // --- CHARACTER/TURRET DRAW ---
    function drawCharacter(ctx, x, y, facing, shooting, dancing, frame) {
      ctx.save();
      ctx.translate(x, y);

      // DANCE: bounce and wiggle after shooting
      if (dancing) {
        let dancePhase = Math.sin(frame * 0.18 + (facing === 'left' ? 1 : 0)) * 8;
        ctx.translate(0, dancePhase);
        ctx.rotate(Math.sin(frame*0.13 + (facing==='left'?1.7:0))*0.15);
      }

      ctx.scale(facing === 'left' ? -1 : 1, 1);

      // Body
      ctx.beginPath();
      ctx.arc(0, 0, 18, 0, Math.PI * 2);
      ctx.fillStyle = "#fff";
      ctx.shadowColor = "#666";
      ctx.shadowBlur = 8;
      ctx.fill();
      ctx.shadowBlur = 0;

      // Eyes
      ctx.beginPath(); ctx.arc(-6, -2, 3.2, 0, Math.PI * 2);
      ctx.arc(6, -2, 3.2, 0, Math.PI * 2);
      ctx.fillStyle = "#222";
      ctx.fill();

      // Smile (big smile if dancing)
      ctx.beginPath();
      let smileY = dancing ? 11 : 7;
      let smileR = dancing ? 8.5 : 7;
      ctx.arc(0, smileY, smileR, Math.PI*0.15, Math.PI*0.85);
      ctx.strokeStyle = "#222";
      ctx.lineWidth = 2;
      ctx.stroke();

      // Arms: recoil when shooting
      ctx.save();
      let armsUp = shooting ? Math.sin(frame*0.35)*0.4+0.7 : (dancing?0.4:0.05);
      ctx.rotate(-armsUp);
      ctx.beginPath();
      ctx.arc(-13, 8, 7, Math.PI*0.4, Math.PI*1.6);
      ctx.lineWidth = 6;
      ctx.strokeStyle = "#fff";
      ctx.stroke();
      ctx.lineWidth = 2;
      ctx.strokeStyle = "#222";
      ctx.stroke();
      ctx.restore();

      ctx.save();
      ctx.rotate(armsUp);
      ctx.beginPath();
      ctx.arc(13, 8, 7, Math.PI*1.6, Math.PI*0.4, true);
      ctx.lineWidth = 6;
      ctx.strokeStyle = "#fff";
      ctx.stroke();
      ctx.lineWidth = 2;
      ctx.strokeStyle = "#222";
      ctx.stroke();
      ctx.restore();

      // Saucer
      ctx.save();
      ctx.translate(0, 22);
      ctx.beginPath();
      ctx.ellipse(0, 0, 18, 7, 0, 0, Math.PI * 2);
      ctx.fillStyle = "#eee";
      ctx.fill();
      ctx.beginPath();
      ctx.ellipse(0, 0, 18, 7, 0, 0, Math.PI * 2);
      ctx.strokeStyle = "#999";
      ctx.lineWidth = 2.5;
      ctx.stroke();
      ctx.restore();

      // Shooting "glow"
      if (shooting && frame%20<10) {
        ctx.save();
        ctx.globalAlpha = 0.35;
        ctx.shadowColor = "#ff1361";
        ctx.shadowBlur = 16;
        ctx.beginPath();
        ctx.arc(0, 0, 23, 0, Math.PI*2);
        ctx.fillStyle = "#ff1361";
        ctx.fill();
        ctx.restore();
      }

      ctx.restore();
    }

    // HEART OUTLINE PARAMS
    function getHeartOutline(w, h, heartsCount) {
      let cx = w / 2, cy = h * 0.45, r = Math.min(w,h)/3.2;
      let coords = [];
      for (let i = 0; i < heartsCount; i++) {
        let t = i / (heartsCount - 1);
        let angle = Math.PI * (1.12 * t + 0.2);
        let px = cx + Math.sin(angle) * r * (1 - 0.23 * Math.abs(t - 0.5));
        let py = cy - Math.cos(angle) * r - 37 * Math.abs(t - 0.5);
        coords.push({x: px, y: py, angle});
      }
      return coords;
    }

    // --- ANIMATED EMOJI HEART FLY-IN ---
    let flyingHearts = [];
    let animationFrame = 0;
    let shooting = true;
    let dancing = false;
    function startHeartAnimation() {
      flyingHearts = [];
      animationFrame = 0;
      shooting = true;
      dancing = false;
      const w = canvas.width, h = canvas.height;
      const heartOutline = getHeartOutline(w, h, 42);

      for (let i = 0; i < heartOutline.length; i++) {
        let t = i / (heartOutline.length - 1);
        let fromX = t < 0.5 ? 60 : w-60;
        let fromY = h-65;
        let {x: toX, y: toY} = heartOutline[i];
        let cpX = (fromX + toX)/2 + (t<0.5?-60:60);
        let cpY = Math.min(fromY, toY) - 120;
        flyingHearts.push({
          fromX, fromY, cpX, cpY, toX, toY,
          progress: 0,
          arrived: false,
          scale: 0.7,
          alpha: 0.2,
          rot: Math.random()*2*Math.PI
        });
      }
    }

    function drawEmojiHeart(ctx, x, y, size, rot, alpha) {
      ctx.save();
      ctx.globalAlpha = alpha;
      ctx.font = `bold ${size}px serif`;
      ctx.translate(x, y);
      ctx.rotate(rot);
      ctx.shadowColor = "#fb1458";
      ctx.shadowBlur = size*0.21;
      ctx.fillText("❤️", 0, 0);
      ctx.restore();
    }

    function drawScene() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Characters on saucers
      let allArrived = flyingHearts.every(h=>h.arrived);
      drawCharacter(ctx, 60, canvas.height - 65, 'right', shooting && !allArrived, dancing && allArrived, animationFrame);
      drawCharacter(ctx, canvas.width - 60, canvas.height - 65, 'left', shooting && !allArrived, dancing && allArrived, animationFrame);

      // Animate hearts
      for (let i = 0; i < flyingHearts.length; i++) {
        let heart = flyingHearts[i];
        if (!heart.arrived) {
          heart.progress += 0.04 + 0.02*(i%3==0?1:0);
          if (heart.progress>=1) {
            heart.progress = 1; heart.arrived = true;
            heart.scale = 1; heart.alpha = 1; heart.rot = 0;
          }
        }
        let t = heart.progress;
        let bx = (1-t)*(1-t)*heart.fromX + 2*(1-t)*t*heart.cpX + t*t*heart.toX;
        let by = (1-t)*(1-t)*heart.fromY + 2*(1-t)*t*heart.cpY + t*t*heart.toY;
        let scale = heart.arrived ? 1 : 0.7+0.3*t;
        let alpha = heart.arrived ? 1 : 0.2+0.8*t;
        let rot = heart.arrived ? 0 : heart.rot*(1-t);
        drawEmojiHeart(ctx, bx, by, 33*scale, rot, alpha);
      }

      // "Te amo" text (only after all arrived)
      if (allArrived) {
        ctx.save();
        ctx.font = "bold 55px Arial Rounded MT Bold, Arial, sans-serif";
        ctx.fillStyle = "#fa4f86";
        ctx.textAlign = "center";
        ctx.shadowColor = "#ff1361";
        ctx.shadowBlur = 20;
        ctx.fillText("Te amo", canvas.width / 2, canvas.height * 0.18);
        ctx.restore();
        shooting = false;
        dancing = true;
      }

      animationFrame++;
      requestAnimationFrame(drawScene);
    }

    btn.addEventListener("click", () => {
      btn.style.opacity = 0;
      setTimeout(() => { btn.style.display = 'none'; }, 600);
      canvas.style.display = "block";
      startHeartAnimation();
      drawScene();
    });
  </script>
</body>
</html>
